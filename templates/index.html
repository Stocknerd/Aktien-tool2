<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Aktien-Bild-Generator - Suche</title>
    <style>
      /* Styles für die Autocomplete-Ergebnisse */
      #results {
        border: 1px solid #ccc;
        max-width: 300px;
        position: absolute;
        background-color: white;
        z-index: 10;
      }
      .result-item {
        padding: 5px;
        cursor: pointer;
      }
      .result-item:hover {
        background-color: #eee;
      }
    </style>
</head>
<body>
    <h1>Aktien-Bild-Generator</h1>
    <form action="/generate_image" method="POST">
        <!-- Suchfeld für den Unternehmensnamen -->
        <label for="search-box">Unternehmen suchen:</label>
        <input type="text" id="search-box" placeholder="Unternehmen eingeben...">
        <div id="results"></div>
        <br><br>
        <!-- Ticker-Feld, das automatisch befüllt wird -->
        <label for="ticker">Ticker:</label>
        <input type="text" name="ticker" id="ticker" required readonly>
        <br><br>
        <button type="submit">Bild generieren</button>
    </form>

    <script>
      const searchBox = document.getElementById('search-box');
      const resultsDiv = document.getElementById('results');
      const tickerInput = document.getElementById('ticker');

      // Bei Eingabe im Suchfeld: AJAX-Request an den /search-Endpoint
      searchBox.addEventListener('input', function() {
          const query = this.value.trim();
          if(query.length < 2) {
              resultsDiv.innerHTML = "";
              return;
          }
          fetch(`/search?q=${encodeURIComponent(query)}`)
              .then(response => response.json())
              .then(data => {
                  resultsDiv.innerHTML = "";
                  data.results.forEach(item => {
                      const div = document.createElement('div');
                      div.className = 'result-item';
                      div.textContent = `${item.Security} (${item.Symbol})`;
                      div.addEventListener('click', function() {
                          // Bei Klick: Ticker-Feld füllen und Suchfeld mit dem Firmennamen befüllen
                          tickerInput.value = item.Symbol;
                          searchBox.value = item.Security;
                          resultsDiv.innerHTML = "";
                      });
                      resultsDiv.appendChild(div);
                  });
              })
              .catch(error => {
                  console.error('Fehler bei der Suche:', error);
              });
      });
    </script>
</body>
</html>
